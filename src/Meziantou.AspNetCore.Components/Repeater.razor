@* T is the type of objects to enumerate in the repeater *@
@* It should be inferred automatically based on the Items property *@
@* You can specify it manually by using <Repeater T=Person /> *@
@typeparam T

@*
/// <summary>
/// A component that renders a collection of items with customizable templates for items, separators, empty state, and loading state.
/// </summary>
/// <typeparam name="T">The type of items in the collection.</typeparam>
/// <example>
/// <code>
/// &lt;Repeater Items="@users"
///           ItemTemplate="@(user => <div>@user.Name</div>)"
///           ItemSeparatorTemplate="<hr />"
///           EmptyTemplate="<p>No users found</p>"
///           LoadingTemplate="<p>Loading users...</p>" /&gt;
/// </code>
/// </example>
*@

@if (Items == null)
{
    @LoadingTemplate
}
else
{
    if (EmptyTemplate != null && !Items.Any())
    {
        @EmptyTemplate
    }
    else
    {
        @RepeaterContainerTemplate(
            @: @{
                var first = true;
                foreach (var item in Items)
                {
                    if (!first && ItemSeparatorTemplate != null)
                    {
                        @ItemSeparatorTemplate
                    }

                    @if (ItemTemplate != null)
                    {
                        @ItemTemplate(item);
                    }
                    first = false;
                }
            }
            )
    }
}

@code {
    private static RenderFragment<RenderFragment> s_defaultContainerTemplate = new RenderFragment<RenderFragment>(fragment => fragment);

    /// <summary>Gets or sets the collection of items to render. When <c>null</c>, the <see cref="LoadingTemplate"/> is displayed.</summary>
    [Parameter]
    public IEnumerable<T>? Items { get; set; }

    /// <summary>Gets or sets the template to display while the items are being loaded (when <see cref="Items"/> is <c>null</c>).</summary>
    [Parameter]
    public RenderFragment? LoadingTemplate { get; set; }

    /// <summary>Gets or sets the container template that wraps all items. The default template renders items directly without a container.</summary>
    [Parameter]
    public RenderFragment<RenderFragment> RepeaterContainerTemplate { get; set; } = s_defaultContainerTemplate;

    /// <summary>Gets or sets the template for rendering each item in the collection.</summary>
    [Parameter]
    public RenderFragment<T>? ItemTemplate { get; set; }

    /// <summary>Gets or sets the template to render between each item in the collection.</summary>
    [Parameter]
    public RenderFragment? ItemSeparatorTemplate { get; set; }

    /// <summary>Gets or sets the template to display when the collection is empty.</summary>
    [Parameter]
    public RenderFragment? EmptyTemplate { get; set; }

    protected override void OnParametersSet()
    {
        // Create empty template in case the user doesn't provide it
        RepeaterContainerTemplate ??= s_defaultContainerTemplate;
    }
}